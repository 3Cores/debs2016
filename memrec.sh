#!/usr/bin/env bash

#**************************************************************************************************
# MEMORY CHECKING
#
# $1 [period]: memory recording period (in seconds)
# $2 [file]  : file to record
#**************************************************************************************************

#**************************************************************************************************
# INIT
#**************************************************************************************************
function init {
    _PERIOD=10
    _FILE="memrec.txt"

    if [ $1 ]; then
        _PERIOD=$1
    fi

    if [ $2 ]; then
        _FILE=$2
    fi

}

#**************************************************************************************************
# MEMORY RECORDING
#**************************************************************************************************
function memoryRecording {
    while true; do
        free -m | awk 'FNR==3 {printf $3 "\t"};FNR==4 {print $3}' >> "${_FILE}"
        sleep ${_PERIOD}s
    done
}

#**************************************************************************************************
# DEINIT
#**************************************************************************************************
function deinit {
    unset _PERIOD
    unset _FILE
}

#**************************************************************************************************
# BODY
#**************************************************************************************************
init

memoryRecording

deinit
